{
    "id": "metrics-micrometer",
    "name": "Micrometer Metrics",
    "version": "2.0.0",
    "ktor_version": "2.0.0",
    "short_description": "Enables Micrometer metrics in your Ktor server application.",
    "github": "https://github.com/ktorio/ktor/blob/4a50c76c3264b0121b91a203d38473bb4aafbace/ktor-features/ktor-metrics-micrometer/jvm/src/io/ktor/metrics/micrometer/MicrometerMetrics.kt",
    "copyright": "Apache 2.0",
    "vendor": {
        "name": "Ktor",
        "url": "https://ktor.io/"
    },
    "group": "Monitoring",
    "required_feature_ids": [
        "routing"
    ],
    "install_recipe": {
        "imports": [
            "io.micrometer.prometheus.*",
            "io.ktor.server.metrics.micrometer.*",
            "io.ktor.server.response.*"
        ],
        "install_block": "val appMicrometerRegistry = PrometheusMeterRegistry(PrometheusConfig.DEFAULT)\n\n    install(MicrometerMetrics) {\n        registry = appMicrometerRegistry\n        // ...\n    }",
        "templates": [
            {
                "position": "in_routing",
                "text": "get(\"/metrics-micrometer\") {\n    call.respond(appMicrometerRegistry.scrape())\n}"
            }
        ]
    },
    "dependencies": [
        {
            "group": "io.ktor",
            "artifact": "ktor-server-metrics-micrometer-jvm",
            "version": "$ktor_version"
        },
        {
            "group": "io.micrometer",
            "artifact": "micrometer-registry-prometheus",
            "version": "$prometeus_version",
            "version_value": "1.6.3"
        }
    ],
    "documentation": {
        "description": "The [MicrometerMetrics](https://ktor.io/docs/micrometer-metrics.html) plugin enables `Micrometer` metrics in your Ktor server application and allows you to choose the required monitoring system, such as Prometheus, JMX, Elastic, and so on. By default, Ktor exposes metrics for monitoring HTTP requests and a set of low-level metrics for monitoring the JVM. You can customize these metrics or create new ones.",
        "usage": "To use `MicrometerMetrics`, you need to create a registry for your monitoring system and assign it to the `registry` property:\n\n```kotlin\nfun Application.module() {\n    val appMicrometerRegistry = PrometheusMeterRegistry(PrometheusConfig.DEFAULT)\n    install(MicrometerMetrics) {\n        registry = appMicrometerRegistry\n    }\n}\n```\n\nThen, you can configure various metrics. For example, to customize tags for each timer, you can use the `timers` function that is called for each request:\n\n```kotlin\ninstall(MicrometerMetrics) {\n    // ...\n    timers { call, exception ->\n        tag(\"region\", call.request.headers[\"regionId\"])\n    }\n}\n```\n\nYou can learn more from the [Micrometer metrics](https://ktor.io/docs/micrometer-metrics.html) topic.",
        "options": ""
    }
}